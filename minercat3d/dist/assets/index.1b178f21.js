var Jt=Object.defineProperty;var Qt=(t,e,n)=>e in t?Jt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var xt=(t,e,n)=>(Qt(t,typeof e!="symbol"?e+"":e,n),n);const Dt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}};Dt();var Ct=1e-6,D=typeof Float32Array!="undefined"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function Yt(){var t=new D(16);return D!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function te(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ee(t,e,n,o,r){var i=1/Math.tan(e/2),c;return t[0]=i/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(c=1/(o-r),t[10]=(r+o)*c,t[14]=2*r*o*c):(t[10]=-1,t[14]=-2*o),t}var ne=ee;function oe(t,e,n,o){var r,i,c,s,f,x,y,a,b,l,A=e[0],m=e[1],E=e[2],N=o[0],_=o[1],M=o[2],R=n[0],d=n[1],u=n[2];return Math.abs(A-R)<Ct&&Math.abs(m-d)<Ct&&Math.abs(E-u)<Ct?te(t):(y=A-R,a=m-d,b=E-u,l=1/Math.hypot(y,a,b),y*=l,a*=l,b*=l,r=_*b-M*a,i=M*y-N*b,c=N*a-_*y,l=Math.hypot(r,i,c),l?(l=1/l,r*=l,i*=l,c*=l):(r=0,i=0,c=0),s=a*c-b*i,f=b*r-y*c,x=y*i-a*r,l=Math.hypot(s,f,x),l?(l=1/l,s*=l,f*=l,x*=l):(s=0,f=0,x=0),t[0]=r,t[1]=s,t[2]=y,t[3]=0,t[4]=i,t[5]=f,t[6]=a,t[7]=0,t[8]=c,t[9]=x,t[10]=b,t[11]=0,t[12]=-(r*A+i*m+c*E),t[13]=-(s*A+f*m+x*E),t[14]=-(y*A+a*m+b*E),t[15]=1,t)}function Y(){var t=new D(3);return D!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function C(t,e,n){var o=new D(3);return o[0]=t,o[1]=e,o[2]=n,o}function Ht(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Gt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Vt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function Xt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function K(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t}function Wt(t,e){var n=e[0],o=e[1],r=e[2],i=n*n+o*o+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function ie(t,e,n){var o=e[0],r=e[1],i=e[2],c=n[0],s=n[1],f=n[2];return t[0]=r*f-i*s,t[1]=i*c-o*f,t[2]=o*s-r*c,t}(function(){var t=Y();return function(e,n,o,r,i,c){var s,f;for(n||(n=3),o||(o=0),r?f=Math.min(r*n+o,e.length):f=e.length,s=o;s<f;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],i(t,t,c),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}})();function $t(){var t=new D(2);return D!=Float32Array&&(t[0]=0,t[1]=0),t}function re(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function ce(t){return t[0]=0,t[1]=0,t}(function(){var t=$t();return function(e,n,o,r,i,c){var s,f;for(n||(n=2),o||(o=0),r?f=Math.min(r*n+o,e.length):f=e.length,s=o;s<f;s+=n)t[0]=e[s],t[1]=e[s+1],i(t,t,c),e[s]=t[0],e[s+1]=t[1];return e}})();const se=39,mt=[0,.5,.5,1,1.25,1.5,1.75,2,5,6,7,8,25,30,35,40,125,150,175,200,600,750,850,950,4e3,4500,5e3,5500,2e4,21e3,22e3,23e3,8e4,85e3,9e4,95e3,32e4,33e4,34e4,35e4,0,0],qt=new Map;function z(t,e){qt.set(t,JSON.stringify(e))}const fe=document.getElementById("debug");function Kt(){let t="";for(const[e,n]of qt)t+=`${e}: ${n}
`;fe.textContent=t,requestAnimationFrame(Kt)}requestAnimationFrame(Kt);let I=Object.create(null),Zt=Object.create(null);window.onkeydown=t=>{I[t.code]||(Zt[t.code]=!0),I[t.code]=!0};window.onkeyup=t=>I[t.code]=!1;let jt=Object.create(null);window.onmousedown=t=>{jt[t.button]=!0};let O=$t();window.addEventListener("mousemove",t=>{!document.pointerLockElement||(t.movementX!==-2&&(O[0]+=t.movementX),O[1]+=t.movementY)});const At=2.75,bt=-1,U=.1875;function le(t,e){var n,o,r;ae(e,t),t.velocity[1]-=16*e,t.velocity[1]<-30&&(t.velocity[1]=-30),de(e,t),ve(t,e),jt[0]&&t.highlighted&&t.blocks.setBlock(t.highlighted,0),t.highlighted=he(t),z("position",t.position),z("facing",t.facing),z("pitch",t.pitch),z("yaw",t.yaw),z("highlighted position",t.highlighted),z("highlighted block id",t.blocks.getBlock((n=t.highlighted)!=null?n:[0,0,0])),z("highlighted block health",t.blocks.getBlockHealth((o=t.highlighted)!=null?o:[0,0,0])),z("highlighted block max health",mt[t.blocks.getBlock((r=t.highlighted)!=null?r:[0,0,0])]),z("velocity",t.velocity),z("isOnGround",t.isOnGround),Zt=Object.create(null),jt=Object.create(null)}function he(t){const n=Y();for(let o=0;o<100;o+=.5)if(K(n,t.position,t.facing,o),Vt(n,n),n[1]*=-1,t.blocks.getBlock(n))return n;return null}function ae(t,e){let n=5;I.ArrowRight&&(O[0]+=n),I.ArrowLeft&&(O[0]-=n),I.ArrowUp&&(O[1]-=n),I.ArrowDown&&(O[1]+=n),re(O,O,.15),e.yaw+=O[0],e.pitch-=O[1],e.pitch>89&&(e.pitch=89),e.pitch<-89&&(e.pitch=-89),ue(e),ce(O)}function ue(t){const e=Y(),n=o=>o/180*Math.PI;e[0]=Math.cos(n(t.yaw))*Math.cos(n(t.pitch)),e[1]=Math.sin(n(t.pitch)),e[2]=Math.sin(n(t.yaw))*Math.cos(n(t.pitch)),Wt(t.facing,e)}function de(t,e){const o=Ht(Y(),e.facing);o[1]=0,Wt(o,o);const r=ie(Y(),o,[0,1,0]);e.velocity[0]=0,e.velocity[2]=0,I.KeyW&&K(e.velocity,e.velocity,o,8),I.KeyS&&K(e.velocity,e.velocity,o,-8),I.Space&&e.isOnGround&&(e.velocity[1]=9),I.ShiftLeft,I.KeyA&&K(e.velocity,e.velocity,r,-8),I.KeyD&&K(e.velocity,e.velocity,r,8)}function ye(t,e){return Ht(t,e),t[1]*=-1,Vt(t,t),t}function ve(t,e){const n=Xt(Y(),t.velocity,e);Nt(t,C(n[0],0,0))&&(t.velocity[0]=0),Nt(t,C(0,n[1],0))?(t.velocity[1]=0,n[1]<=0&&(t.isOnGround=!0)):t.isOnGround=!1,Nt(t,C(0,0,n[2]))&&(t.velocity[2]=0)}function Nt(t,e){for(let o=0;o<10;o++)if(K(t.position,t.position,e,1/10),xe(t))return K(t.position,t.position,e,-1/10),!0;return!1}const pe=[C(-U,-At,-U),C(-U,-At,U),C(U,-At,-U),C(U,-At,U),C(-U,bt,-U),C(-U,bt,U),C(U,bt,-U),C(U,bt,U)];function xe(t){const e=Y(),n=Y();for(const o of pe)if(Gt(n,t.position,o),ye(e,n),t.blocks.getBlock(e))return!0;return!1}const Ae=.5*(Math.sqrt(3)-1),pt=(3-Math.sqrt(3))/6,be=1/3,H=1/6,me=(Math.sqrt(5)-1)/4,L=(5-Math.sqrt(5))/20,S=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),F=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class ke{constructor(e=Math.random){const n=typeof e=="function"?e:Re(e);this.p=Me(n),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let o=0;o<512;o++)this.perm[o]=this.p[o&255],this.permMod12[o]=this.perm[o]%12}noise2D(e,n){const o=this.permMod12,r=this.perm;let i=0,c=0,s=0;const f=(e+n)*Ae,x=Math.floor(e+f),y=Math.floor(n+f),a=(x+y)*pt,b=x-a,l=y-a,A=e-b,m=n-l;let E,N;A>m?(E=1,N=0):(E=0,N=1);const _=A-E+pt,M=m-N+pt,R=A-1+2*pt,d=m-1+2*pt,u=x&255,v=y&255;let p=.5-A*A-m*m;if(p>=0){const w=o[u+r[v]]*3;p*=p,i=p*p*(S[w]*A+S[w+1]*m)}let T=.5-_*_-M*M;if(T>=0){const w=o[u+E+r[v+N]]*3;T*=T,c=T*T*(S[w]*_+S[w+1]*M)}let B=.5-R*R-d*d;if(B>=0){const w=o[u+1+r[v+1]]*3;B*=B,s=B*B*(S[w]*R+S[w+1]*d)}return 70*(i+c+s)}noise3D(e,n,o){const r=this.permMod12,i=this.perm;let c,s,f,x;const y=(e+n+o)*be,a=Math.floor(e+y),b=Math.floor(n+y),l=Math.floor(o+y),A=(a+b+l)*H,m=a-A,E=b-A,N=l-A,_=e-m,M=n-E,R=o-N;let d,u,v,p,T,B;_>=M?M>=R?(d=1,u=0,v=0,p=1,T=1,B=0):_>=R?(d=1,u=0,v=0,p=1,T=0,B=1):(d=0,u=0,v=1,p=1,T=0,B=1):M<R?(d=0,u=0,v=1,p=0,T=1,B=1):_<R?(d=0,u=1,v=0,p=0,T=1,B=1):(d=0,u=1,v=0,p=1,T=1,B=0);const w=_-d+H,g=M-u+H,tt=R-v+H,et=_-p+2*H,nt=M-T+2*H,ot=R-B+2*H,it=_-1+3*H,rt=M-1+3*H,ct=R-1+3*H,Z=a&255,J=b&255,Q=l&255;let $=.6-_*_-M*M-R*R;if($<0)c=0;else{const P=r[Z+i[J+i[Q]]]*3;$*=$,c=$*$*(S[P]*_+S[P+1]*M+S[P+2]*R)}let q=.6-w*w-g*g-tt*tt;if(q<0)s=0;else{const P=r[Z+d+i[J+u+i[Q+v]]]*3;q*=q,s=q*q*(S[P]*w+S[P+1]*g+S[P+2]*tt)}let X=.6-et*et-nt*nt-ot*ot;if(X<0)f=0;else{const P=r[Z+p+i[J+T+i[Q+B]]]*3;X*=X,f=X*X*(S[P]*et+S[P+1]*nt+S[P+2]*ot)}let W=.6-it*it-rt*rt-ct*ct;if(W<0)x=0;else{const P=r[Z+1+i[J+1+i[Q+1]]]*3;W*=W,x=W*W*(S[P]*it+S[P+1]*rt+S[P+2]*ct)}return 32*(c+s+f+x)}noise4D(e,n,o,r){const i=this.perm;let c,s,f,x,y;const a=(e+n+o+r)*me,b=Math.floor(e+a),l=Math.floor(n+a),A=Math.floor(o+a),m=Math.floor(r+a),E=(b+l+A+m)*L,N=b-E,_=l-E,M=A-E,R=m-E,d=e-N,u=n-_,v=o-M,p=r-R;let T=0,B=0,w=0,g=0;d>u?T++:B++,d>v?T++:w++,d>p?T++:g++,u>v?B++:w++,u>p?B++:g++,v>p?w++:g++;const tt=T>=3?1:0,et=B>=3?1:0,nt=w>=3?1:0,ot=g>=3?1:0,it=T>=2?1:0,rt=B>=2?1:0,ct=w>=2?1:0,Z=g>=2?1:0,J=T>=1?1:0,Q=B>=1?1:0,$=w>=1?1:0,q=g>=1?1:0,X=d-tt+L,W=u-et+L,P=v-nt+L,kt=p-ot+L,Et=d-it+2*L,Mt=u-rt+2*L,Rt=v-ct+2*L,Tt=p-Z+2*L,Bt=d-J+3*L,_t=u-Q+3*L,Ft=v-$+3*L,wt=p-q+3*L,Pt=d-1+4*L,St=u-1+4*L,Lt=v-1+4*L,Ut=p-1+4*L,st=b&255,ft=l&255,lt=A&255,ht=m&255;let at=.6-d*d-u*u-v*v-p*p;if(at<0)c=0;else{const k=i[st+i[ft+i[lt+i[ht]]]]%32*4;at*=at,c=at*at*(F[k]*d+F[k+1]*u+F[k+2]*v+F[k+3]*p)}let ut=.6-X*X-W*W-P*P-kt*kt;if(ut<0)s=0;else{const k=i[st+tt+i[ft+et+i[lt+nt+i[ht+ot]]]]%32*4;ut*=ut,s=ut*ut*(F[k]*X+F[k+1]*W+F[k+2]*P+F[k+3]*kt)}let dt=.6-Et*Et-Mt*Mt-Rt*Rt-Tt*Tt;if(dt<0)f=0;else{const k=i[st+it+i[ft+rt+i[lt+ct+i[ht+Z]]]]%32*4;dt*=dt,f=dt*dt*(F[k]*Et+F[k+1]*Mt+F[k+2]*Rt+F[k+3]*Tt)}let yt=.6-Bt*Bt-_t*_t-Ft*Ft-wt*wt;if(yt<0)x=0;else{const k=i[st+J+i[ft+Q+i[lt+$+i[ht+q]]]]%32*4;yt*=yt,x=yt*yt*(F[k]*Bt+F[k+1]*_t+F[k+2]*Ft+F[k+3]*wt)}let vt=.6-Pt*Pt-St*St-Lt*Lt-Ut*Ut;if(vt<0)y=0;else{const k=i[st+1+i[ft+1+i[lt+1+i[ht+1]]]]%32*4;vt*=vt,y=vt*vt*(F[k]*Pt+F[k+1]*St+F[k+2]*Lt+F[k+3]*Ut)}return 27*(c+s+f+x+y)}}var Ee=ke;function Me(t){const e=new Uint8Array(256);for(let n=0;n<256;n++)e[n]=n;for(let n=0;n<255;n++){const o=n+~~(t()*(256-n)),r=e[n];e[n]=e[o],e[o]=r}return e}function Re(t){let e=0,n=0,o=0,r=1;const i=Te();return e=i(" "),n=i(" "),o=i(" "),e-=i(t),e<0&&(e+=1),n-=i(t),n<0&&(n+=1),o-=i(t),o<0&&(o+=1),function(){const c=2091639*e+r*23283064365386963e-26;return e=n,n=o,o=c-(r=c|0)}}function Te(){let t=4022871197;return function(e){e=e.toString();for(let n=0;n<e.length;n++){t+=e.charCodeAt(n);let o=.02519603282416938*t;t=o>>>0,o-=t,o*=t,t=o>>>0,o-=t,t+=o*4294967296}return(t>>>0)*23283064365386963e-26}}const It=[{y:5,tries:[{do:0}]},{y:6,tries:[{do:{type:"firstlayer"}}]},{y:7,tries:[{do:2}]},{y:24,tries:[{chance:10,do:4},{chance:12,do:5},{chance:14,do:6},{chance:16,do:7},{do:3}]},{y:60,tries:[{chance:10,do:9},{chance:12,do:10},{chance:14,do:11},{do:8}]},{y:110,tries:[{chance:10,do:13},{chance:12,do:14},{chance:14,do:15},{do:12}]},{y:160,tries:[{chance:10,do:17},{chance:12,do:18},{chance:14,do:19},{do:16}]},{y:225,tries:[{chance:10,do:21},{chance:12,do:22},{chance:14,do:23},{do:20}]},{y:300,tries:[{chance:10,do:25},{chance:12,do:26},{chance:14,do:27},{do:24}]},{y:375,tries:[{chance:10,do:29},{chance:12,do:30},{chance:14,do:31},{do:28}]},{y:500,tries:[{chance:10,do:33},{chance:12,do:34},{chance:14,do:35},{do:32}]},{y:8250,tries:[{chance:10,do:37},{chance:12,do:38},{chance:14,do:39},{do:36}]}];function Be(t){_e(t),we(t);for(let e=0;e<V;e++)for(let n=0;n<h;n++)for(let o=0;o<h;o++)t.setBlockHealth([n,e,o],mt[t.getBlock([n,e,o])])}function _e(t){let e=0;for(let n=0;n<V&&(n>It[e].y&&e++,!(e>=It.length));n++)for(let o=0;o<h;o++)for(let r=0;r<h;r++)for(const i of It[e].tries)if(!("chance"in i&&Math.random()>=1/i.chance)){if(typeof i.do=="number")t.setBlock([o,n,r],i.do);else if(i.do.type=="firstlayer"){const c=Math.floor(h/2);(o==c||o==c-1)&&(r==c||r==c-1)?t.setBlock([o,n,r],se):t.setBlock([o,n,r],1)}break}}let Fe=new Ee;function we(t){for(let e=0;e<V;e++)for(let n=0;n<h;n++)for(let o=0;o<h;o++){let r=Math.max(0,Math.min(1,(e-5)/5));r*=Math.min(8,Math.min(n,h-n))/8,r*=Math.min(8,Math.min(o,h-o))/8;const i=.08,c=.45;Fe.noise3D(n*i,e*i,o*i)*r>c&&t.setBlock([n,e,o],0)}}var Pe="/minercat3d/assets/blocks.ef3cb20d.png";const h=24,V=8250,Ot=h*h;function G(t){throw alert(t),new Error(t)}class Se{constructor(){xt(this,"array");xt(this,"gl",null);xt(this,"buffer",null);this.array=new Uint32Array(Ot*V),Be(this)}getBlock([e,n,o]){return e<0||e>=h||o<0||o>=h||n<0||n>=V?0:this.array[e+h*(o+h*n)]&63}setBlock([e,n,o],r){var c,s;if(e<0||e>=h||o<0||o>=h||n<0||n>=V)return;const i=e+h*(o+h*n);this.array[i]=(this.array[i]&-64)+r,(c=this.gl)==null||c.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),(s=this.gl)==null||s.bufferSubData(this.gl.ARRAY_BUFFER,i*4,this.array,i,4)}getBlockHealth([e,n,o]){return e<0||e>=h||o<0||o>=h||n<0||n>=V?0:this.array[e+h*(o+h*n)]>>6}setBlockHealth([e,n,o],r){var c,s;if(e<0||e>=h||o<0||o>=h||n<0||n>=V)return;const i=e+h*(o+h*n);this.array[i]=(this.array[i]&63)+(r<<6),(c=this.gl)==null||c.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),(s=this.gl)==null||s.bufferSubData(this.gl.ARRAY_BUFFER,i*4,this.array,i,4)}}let j={position:C(h/2,10,h/2),facing:C(0,0,0),cameraUp:C(0,1,0),pitch:0,yaw:0,highlighted:null,blocks:new Se,velocity:Y(),isOnGround:!1};function gt(t,e){const n=e=="uint"?"u":"";let o=e+"[](",r="";for(const i of t)o+=r+i.toFixed()+n,r=", ";return o+=")",o}function Le(){var y,a,b,l,A;const t=document.querySelector("#canvas");t.addEventListener("click",()=>t.requestPointerLock());const e=t.getContext("webgl2");e||G("Unable to initialize WebGL2"),console.log(gt(mt,"uint"));const n=`#version 300 es

    // vertex attributes
    in vec4 aVertexPosition;
    in vec2 aTextureCoord;
  
    // instance attributes
    in uint iBlock;
  
    out highp vec2 vTextureCoord;
    out highp vec2 vBreakingCoord;
    out float isAir;
    out float isHighlighted;
  
    uniform mat4 uModelViewMatrix;
    uniform mat4 uProjectionMatrix;
    uniform int layerStart;
    uniform vec3 highlighted; // index in array of highlighted block
  
    
    void main() {
      const uint[] blockTypeHealth = ${gt(mt,"uint")};

      int x = gl_InstanceID % ${h};
      int zy = gl_InstanceID / ${h};
      int z = zy % ${h};
      int y = zy / ${h};
      
      vec3 blockPosition = vec3(x, -y-layerStart, z);
      vec3 highlightedPosition = vec3(highlighted.x, -highlighted.y, highlighted.z);
  
  
      uint blockId = iBlock & 63u;
      uint blockHealth = iBlock >> 6u;
      uint textureNum;
  

      isAir = 0.0;
  
      gl_Position = uProjectionMatrix * uModelViewMatrix * (aVertexPosition + vec4(blockPosition, 0.0));
  
      if (blockId == 0u) { // air
        isAir = 1.0;
      } else if (blockId == 1u) { // grass
        if (gl_VertexID >= 8 && gl_VertexID < 12) {
          // top
          textureNum = 0u;
        } else if (gl_VertexID >= 12 && gl_VertexID < 16) {
          // bottom
          textureNum = 2u;
        } else {
          textureNum = 1u;
        }
      } else {
        textureNum = blockId;
      }
  
      isHighlighted = blockPosition == highlightedPosition ? 1.0 : 0.0;
  
      vTextureCoord = (aTextureCoord + vec2(textureNum, 0.0)) / vec2(42.0, 2.0);
      
      float breakingProgress = 1.0 - (float(blockHealth) / float(blockTypeHealth[blockId]));
      uint breakingNum = uint(breakingProgress * 11.0);
      vBreakingCoord = (aTextureCoord + vec2(breakingNum, 1.0)) / vec2(42.0, 2.0);
    }
  `,r=Ue(e,n,`#version 300 es
    precision mediump float;
    precision lowp sampler3D;    out vec4 fragColor;
  
    in highp vec2 vTextureCoord;
    in highp vec2 vBreakingCoord;
    in float isAir;
    in float isHighlighted;

    uniform sampler2D uSampler;
    
    void main() {
      if (isAir > 0.5) { discard; }
      
      if(texture(uSampler, vBreakingCoord).a != 0.0) {
        fragColor = vec4(0.0, 0.0, 0.0, 1.0);
      } else {
        fragColor = texture(uSampler, vTextureCoord);
      }
      
 
      if (isHighlighted > 0.5) {
        vec2 uv = fract(vTextureCoord * vec2(42.0, 2.0));
        float pickerWidth =  1.0 / 16.0;
        if (uv.x < pickerWidth || uv.x > 1. - pickerWidth || uv.y < pickerWidth || uv.y > 1. - pickerWidth) {
          fragColor = vec4(1.0);
        }
      }
      
      // fragColor = vec4(vTextureCoord * vec2(42.0, 1.0), 0.0, 1.0);
    }
  `),i={program:r,attribLocations:{vertexPosition:e.getAttribLocation(r,"aVertexPosition"),textureCoord:e.getAttribLocation(r,"aTextureCoord"),block:e.getAttribLocation(r,"iBlock")},uniformLocations:{projectionMatrix:(y=e.getUniformLocation(r,"uProjectionMatrix"))!=null?y:G("couldn't find uniform uProjectionMatrix"),modelViewMatrix:(a=e.getUniformLocation(r,"uModelViewMatrix"))!=null?a:G("couldn't find uniform uModelViewMatrix"),sampler:(b=e.getUniformLocation(r,"uSampler"))!=null?b:G("couldn't find uniform uSampler"),layerStart:(l=e.getUniformLocation(r,"layerStart"))!=null?l:G("couldn't find uniform layerStart"),highlighted:(A=e.getUniformLocation(r,"highlighted"))!=null?A:G("couldn't find uniform highlighted")}},c=Ne(e),s=Ce(e,Pe);let f=0;function x(m){m*=.001;const E=m-f;f=m,le(j,E),Ie(e,s,i,c),requestAnimationFrame(x)}requestAnimationFrame(x)}function Ue(t,e,n){const o=zt(t,t.VERTEX_SHADER,e),r=zt(t,t.FRAGMENT_SHADER,n),i=t.createProgram();return i||G("error creating shader program"),t.attachShader(i,o),t.attachShader(i,r),t.linkProgram(i),t.getProgramParameter(i,t.LINK_STATUS)||G(`error linking shader program: ${t.getProgramInfoLog(i)}`),i}function zt(t,e,n){const o=t.createShader(e);if(o||G("error creating shader"),t.shaderSource(o,n),t.compileShader(o),!t.getShaderParameter(o,t.COMPILE_STATUS)){const r=t.getShaderInfoLog(o);t.deleteShader(o),G(`error compiling shader: ${r}`)}return o}function Ce(t,e){const n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);const o=0,r=t.RGBA,i=1,c=1,s=0,f=t.RGBA,x=t.UNSIGNED_BYTE,y=new Uint8Array([0,0,255,255]);t.texImage2D(t.TEXTURE_2D,o,r,i,c,s,f,x,y);const a=new Image;return a.onload=function(){t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,o,r,f,x,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST)},a.src=e,n}function Ne(t){const e=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,e);const n=[0,0,1,1,0,1,1,1,1,0,1,1,0,0,0,0,1,0,1,1,0,1,0,0,0,1,0,0,1,1,1,1,1,1,1,0,0,0,0,1,0,0,1,0,1,0,0,1,1,0,0,1,1,0,1,1,1,1,0,1,0,0,0,0,0,1,0,1,1,0,1,0];t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW);const o=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o);const r=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(r),t.STATIC_DRAW);const i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);const c=[0,1,1,1,1,0,0,0,1,1,1,0,0,0,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,1,1,1,0,0,0,0,1,0,1,1,1,1,0,0,0];t.bufferData(t.ARRAY_BUFFER,new Float32Array(c),t.STATIC_DRAW);const s=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,j.blocks.array,t.DYNAMIC_DRAW),j.blocks.buffer=s,j.blocks.gl=t,{vertexPosition:e,indices:o,textureCoord:i}}function Ie(t,e,n,o){var M;const r=C(.4,1,.996),i=C(0,.192,.188),c=Math.max(0,Math.min(1,-j.position[1]/10)),s=Y();Xt(s,r,1-c),K(s,s,i,c),t.clearColor(s[0],s[1],s[2],1),t.clearDepth(1),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT);const f=Math.PI/4,x=t.canvas.clientWidth/t.canvas.clientHeight,y=.1,a=100,b=Yt();ne(b,f,x,y,a);const l=Yt(),A=Y();Gt(A,j.position,j.facing),oe(l,j.position,A,j.cameraUp);{const d=t.FLOAT,u=!1,v=0,p=0;t.bindBuffer(t.ARRAY_BUFFER,o.vertexPosition),t.vertexAttribPointer(n.attribLocations.vertexPosition,3,d,u,v,p),t.enableVertexAttribArray(n.attribLocations.vertexPosition)}const m=-Math.floor(j.position[1]),E=100,N=Math.min(Math.max(0,m-E),V-1),_=Math.max(0,Math.min(V-1,m+E));t.bindBuffer(t.ARRAY_BUFFER,o.textureCoord),t.vertexAttribPointer(n.attribLocations.textureCoord,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(n.attribLocations.textureCoord),t.bindBuffer(t.ARRAY_BUFFER,j.blocks.buffer),t.vertexAttribIPointer(n.attribLocations.block,1,t.UNSIGNED_INT,0,N*Ot),t.vertexAttribDivisor(n.attribLocations.block,1),t.enableVertexAttribArray(n.attribLocations.block),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o.indices),t.useProgram(n.program),t.uniformMatrix4fv(n.uniformLocations.projectionMatrix,!1,b),t.uniformMatrix4fv(n.uniformLocations.modelViewMatrix,!1,l),t.uniform1i(n.uniformLocations.layerStart,N),t.uniform3fv(n.uniformLocations.highlighted,(M=j.highlighted)!=null?M:[0,0,0]),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,e),t.uniform1i(n.uniformLocations.sampler,0);{const u=t.UNSIGNED_SHORT,v=Ot*(_-N);t.drawElementsInstanced(t.TRIANGLES,36,u,0,v)}}window.onload=Le;
